!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["smart-widget-handler"]=e():t["smart-widget-handler"]=e()}(this,(()=>(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function r(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){o(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(t,e,i){return(e=function(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}t.r(e),t.d(e,{default:()=>a});const a={host:{listen:function(t){var e=function(e){var n={};try{n=null!=e&&e.data?JSON.parse(e.data):{}}catch(t){n=(null==e?void 0:e.data)||{}}var i=n,r=i.scope,o=i.kind;"sw-data"!==r||["user-metadata","nostr-event","err-msg","payment-response"].includes(o)||t(n)};return window.addEventListener("message",e),{close:function(){return window.removeEventListener("message",e)}}},sendContext:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"*",n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!t)throw Error("Invalid context value, it must be an object with the user, host_origin");var r=t||{},o=r.pubkey,a=r.display_name,s=r.name,d=r.picture,u=r.banner,l=r.nip05,c=r.lud16,p=r.lud06,v=r.website;if(!o||void 0===a||void 0===s||void 0===d||void 0===u||void 0===l||void 0===c||void 0===p||void 0===v)throw Error("Invalid user values, it must be an object with the following properties pubkey, display_name, name, picture, banner, nip05, lud16, lud06, website");if(!n.startsWith("http://")&&!n.startsWith("https://"))throw Error("Invalid origin value, it must be a valid URL");i.contentWindow.postMessage({data:{user:t,host_origin:e},scope:"sw-data",kind:"user-metadata"},n)},sendEvent:function(t,e,n,i){if(!t||!e)throw Error("Both context and status are required");var r=t||{},o=r.pubkey,a=r.id,s=r.content,d=r.created_at,u=r.tags,l=r.sig,c=r.kind;if(!(o&&a&&void 0!==s&&d&&u&&l&&c))throw Error("Invalid context value, it must be a valid nostr event");if(!n.startsWith("http://")&&!n.startsWith("https://"))throw Error("Invalid origin value, it must be a valid URL");i.contentWindow.postMessage({data:{event:t,status:e},scope:"sw-data",kind:"nostr-event"},n)},sendPaymentResponse:function(t,e,n){if(!t)throw Error("Missing 'context': an object with 'status' and 'preImage' is required.");var i=t||{},o=i.status,a=i.preImage;if(void 0===o||!0===o&&!a)throw Error("Invalid 'context': must include both 'status' and 'preImage' properties.");if(!e.startsWith("http://")&&!e.startsWith("https://"))throw Error("Invalid 'origin': must be a valid URL starting with 'http://' or 'https://'.");n.contentWindow.postMessage({data:r(r({},t),{},{preImage:a||""}),scope:"sw-data",kind:"payment-response"},e)},sendError:function(t,e,n){if(!t)throw Error("Missing errMessage param");n.contentWindow.postMessage({data:t,scope:"sw-data",kind:"err-msg"},e)}},client:{ready:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location.ancestorOrigins[0];"android"===(null===(t=window)||void 0===t||null===(t=t.originSystem)||void 0===t?void 0:t.name)?window.parent.postMessage(JSON.stringify({scope:"sw-data",kind:"app-loaded",data:null})):window.parent.postMessage(JSON.stringify({scope:"sw-data",kind:"app-loaded",data:null}),e)},listen:function(t){var e=function(e){var n={};try{n=null!=e&&e.data?JSON.parse(e.data):{}}catch(t){n=(null==e?void 0:e.data)||{}}var i=n,r=i.scope,o=i.kind;"sw-data"!==r||["app-loaded","sign-event","sign-publish","custom-data"].includes(o)||t(n)};return window.addEventListener("message",e),{close:function(){return window.removeEventListener("message",e)}}},requestEventSign:function(t,e){var n,i=t||{},r=i.content,o=i.tags,a=i.kind;if(void 0===r||!o||!a)throw Error("Invalid context value, it must be a valid nostr event");"android"===(null===(n=window)||void 0===n||null===(n=n.originSystem)||void 0===n?void 0:n.name)?window.parent.postMessage(JSON.stringify({data:t,scope:"sw-data",kind:"sign-event"})):window.parent.postMessage(JSON.stringify({data:t,scope:"sw-data",kind:"sign-event"}),e)},requestEventPublish:function(t,e){var n,i=t||{},r=i.content,o=i.tags,a=i.kind;if(void 0===r||!o||!a)throw Error("Invalid context value, it must be a valid nostr event");"android"===(null===(n=window)||void 0===n||null===(n=n.originSystem)||void 0===n?void 0:n.name)?window.parent.postMessage(JSON.stringify({data:t,scope:"sw-data",kind:"sign-publish"})):window.parent.postMessage(JSON.stringify({data:t,scope:"sw-data",kind:"sign-publish"}),e)},requestPayment:function(t,e){var n,i=t||{},r=i.address,o=i.amount,a=i.nostrPubkey,s=i.nostrEventIDEncode;if(!(r.startsWith("lnbc")||r.includes("@")||r.startsWith("lnurl")))throw new Error("Invalid 'address' in context: must be a valid Lightning address (e.g. user@domain.com), LNURL (starting with 'lnurl'), or BOLT11 invoice (starting with 'lnbc').");if(!(null!=r&&r.startsWith("lnbc")||o))throw new Error("Missing 'amount' in context: amount is required unless the address is a BOLT11 invoice (starting with 'lnbc').");var d={address:r,amount:o,nostrPubkey:a||"",nostrEventIDEncode:s||""};"android"===(null===(n=window)||void 0===n||null===(n=n.originSystem)||void 0===n?void 0:n.name)?window.parent.postMessage(JSON.stringify({data:d,scope:"sw-data",kind:"payment-request"})):window.parent.postMessage(JSON.stringify({data:d,scope:"sw-data",kind:"payment-request"}),e)},sendContext:function(t,e){var n;if(!t||"string"!=typeof t)throw Error("Invalid context value, it must be a string value");"android"===(null===(n=window)||void 0===n||null===(n=n.originSystem)||void 0===n?void 0:n.name)?window.parent.postMessage(JSON.stringify({data:t,scope:"sw-data",kind:"custom-data"})):window.parent.postMessage(JSON.stringify({data:t,scope:"sw-data",kind:"custom-data"}),e)}}};return e})()));